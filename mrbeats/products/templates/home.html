{% extends 'layouts/base.html' %}
{% block title %}All Beats - MyBeats{% endblock %}
<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Music Marketplace</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        background: radial-gradient(
            circle at 10% 20%,
            rgba(60, 0, 100, 0.15) 0%,
            transparent 40%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(0, 255, 200, 0.1) 0%,
            transparent 40%
          ),
          #0b0b0b;
      }
    </style>
  </head>
  {% block content %}
  <body
    class="text-gray-200 flex flex-col items-center justify-center min-h-screen px-6"
  >
    <section class="max-w-2xl mx-auto py-20 text-center">
      <h1 class="text-4xl sm:text-6xl font-extrabold mb-4">
        <span class="text-purple-500">Your Music</span> Marketplace
      </h1>

      <p class="text-gray-400 mb-8 text-lg">
        Buy and sell beats, lyrics, and music services. Connect with talented
        producers, writers, and artists from around the world.
      </p>

      <div class="flex justify-center gap-4 mb-12">
        <a
        href="{%url 'product_list' %}"
          class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition"
        >
          ‚ñ∂ Start Browsing
      </a>
        <a
        href="{% url 'uploads' %}"
          class="bg-transparent border border-gray-600 hover:bg-gray-800 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition"
        >
          üéµ Upload Your Work
        </a>
      </div>

      <!-- Stats Section -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <!-- Card 1 -->
        <div
          class="bg-black/40 backdrop-blur-sm border border-gray-800 p-6 rounded-2xl"
        >
          <div class="text-purple-500 text-3xl mb-2">üé∂</div>
          <h3 class="text-2xl font-bold">10K+</h3>
          <p class="text-gray-400 text-sm">Premium Beats</p>
        </div>

        <!-- Card 2 -->
        <div
          class="bg-black/40 backdrop-blur-sm border border-gray-800 p-6 rounded-2xl"
        >
          <div class="text-cyan-400 text-3xl mb-2">üéß</div>
          <h3 class="text-2xl font-bold">5K+</h3>
          <p class="text-gray-400 text-sm">Active Artists</p>
        </div>

        <!-- Card 3 -->
        <div
          class="bg-black/40 backdrop-blur-sm border border-gray-800 p-6 rounded-2xl"
        >
          <div class="text-green-400 text-3xl mb-2">‚≠ê</div>
          <h3 class="text-2xl font-bold">50K+</h3>
          <p class="text-gray-400 text-sm">Projects Completed</p>
        </div>
      </div>
    </section>
    <section class="max-w-7xl mx-auto px-6 py-20">
      <!-- Heading -->
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-white">
          Featured <span class="text-purple-500">Beats</span>
        </h2>
        <p class="max-w-2xl mx-auto text-gray-400 mt-3">
          Discover the hottest beats from our top producers. Perfect for your
          next track.
        </p>
      </div>

      <!-- Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        {%include 'components/lyrics_modal.html' %}
      <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà card ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï -->
          {% for prod in products %} 
          {% if prod.lyrics_text == "" %}
          {% include "components/card.html" with product=prod %}
          {%else%}
          {% include "components/lyricscard.html" with product=prod%}
          {% endif %}
          {% empty %}
          <p class="text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
          {% endfor %}
      </div>

      <!-- CTA -->
      <div class="mt-12 text-center">
        <a
          href="{%url 'product_list' %}"
          class="inline-block px-6 py-3 border border-gray-700 rounded-full text-white text-sm hover:bg-white/5 transition"
        >
          View All Beats
        </a>
      </div>
    </section>
    {% include 'components/footer.html' %}
  </body>
  <script>
  
  (function () {
    let currentAudio = null;
    let currentBtn = null;

    document.querySelectorAll(".play-btn").forEach((btn) => {
      btn.addEventListener("click", async () => {
        const id = btn.dataset.productId;
        const audio = document.getElementById("audio-" + id);
        const progressEl = document.getElementById("progress-" + id);
        if (!audio || !progressEl) return;

        // ‡∏´‡∏¢‡∏∏‡∏î audio ‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô
        if (currentAudio && currentAudio !== audio) {
          currentAudio.pause();
          document.getElementById(
            "progress-" + currentBtn.dataset.productId
          ).style.width = "0%";
          currentBtn.querySelector(".play-icon").innerHTML =
            '<path d="M8 5v14l11-7L8 5z" fill="currentColor"/>';
        }

        if (audio.paused) {
          await audio.play().catch((err) => console.error(err));
          currentAudio = audio;
          currentBtn = btn;
          btn.querySelector(".play-icon").innerHTML =
            '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" fill="currentColor"/>';
        } else {
          audio.pause();
          btn.querySelector(".play-icon").innerHTML =
            '<path d="M8 5v14l11-7L8 5z" fill="currentColor"/>';
          currentAudio = null;
          currentBtn = null;
          progressEl.style.width = "0%";
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress
        audio.addEventListener("timeupdate", () => {
          if (!audio.duration) return;
          progressEl.style.width =
            (audio.currentTime / audio.duration) * 100 + "%";
        });

        audio.addEventListener("ended", () => {
          progressEl.style.width = "0%";
          btn.querySelector(".play-icon").innerHTML =
            '<path d="M8 5v14l11-7L8 5z" fill="currentColor"/>';
          currentAudio = null;
          currentBtn = null;
        });
      });
    });
  })();
  
(function () {
  const modal = document.getElementById('lyrics-modal');
  const panel = document.getElementById('lyrics-modal-panel');
  const backdrop = document.getElementById('lyrics-modal-backdrop');
  const closeBtn = document.getElementById('lyrics-modal-close');
  const contentEl = document.getElementById('lyrics-modal-content');

  function openModal(text) {
    contentEl.textContent = text || 'No lyrics available.';
    modal.classList.remove('hidden');
    requestAnimationFrame(() => {
      panel.classList.remove('scale-95', 'opacity-0');
      panel.classList.add('scale-100', 'opacity-100');
      document.documentElement.classList.add('overflow-hidden');
    });
  }

  function closeModal() {
    panel.classList.remove('scale-100', 'opacity-100');
    panel.classList.add('scale-95', 'opacity-0');
    setTimeout(() => {
      modal.classList.add('hidden');
      contentEl.textContent = '';
      document.documentElement.classList.remove('overflow-hidden');
    }, 180);
  }

  // delegated: ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° .lyrics-btn
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('.lyrics-btn');
    if (!btn) return;
    e.preventDefault();
    const id = btn.dataset.productId;
    const src = document.getElementById('lyrics-' + id);
    if (!src) {
      openModal('No lyrics available.');
      return;
    }
    const text = src.innerText?.trim() || '';
    openModal(text);
  });

  // ‡∏õ‡∏¥‡∏î modal
  closeBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', closeModal);
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal();
  });
})();

</script>
  {% endblock %}
</html>
