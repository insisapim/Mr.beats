<body class="bg-gray-900 text-gray-100 font-sans">
  <div class="max-w-4xl mx-auto py-12 px-4">
    <div class="mb-6">
      <h1 class="text-3xl font-bold">
        Edits <span class="text-purple-500">Beats</span>
      </h1>
    </div>
    <!-- Upload Beat Form -->
    {{ form.non_field_errors }}
    <form
      method="POST"
      action="{% url 'uploads' %}"
      enctype="multipart/form-data"
      class="bg-gray-800 p-6 rounded-lg space-y-6"
    >
      {% csrf_token %}


      <input type="hidden" name="upload_type" value="beat">
      <!-- File Upload & Cover Art -->
      <section class="grid grid-cols-2 gap-6">
        
        <div class="">
          <!-- Beat File -->

          <div>
            <label class="block mb-2 font-semibold">Beat File (MP3, WAV)</label>
            <div
              class="relative border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-purple-500 flex flex-col items-center justify-center"
            >
              {{productForm.file}}

              <label
                for="{{productForm.file.id_for_label}}"
                class="cursor-pointer flex flex-col items-center"
              >
                <!-- ขยายขนาด SVG -->
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-12 h-12 text-white mb-4"
                  fill="currentColor"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"
                  />
                  <path
                    d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"
                  />
                </svg>

                <!-- ข้อความ -->
                <span class="text-white text-2xl font-semibold"
                  >Drop your beat here</span
                >
                <span class="text-gray-400 text-lg"
                  >or click to browse files</span
                >
              </label>
            </div>
          </div>

          <div class="mt-6">
            <label class="block mb-2 font-semibold"
              >Preview Beat File (MP3, WAV)</label
            >
            <p class="text-gray-400 text-sm mb-1">
              ผู้ซื้อจะได้ฟังสินค้าของคุณที่นี่
            </p>
            <div
              class="relative border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-purple-500 flex flex-col items-center justify-center"
            >
              {{productForm.preview_file}}

              <label
                for="{{productForm.file.id_for_label}}"
                class="cursor-pointer flex flex-col items-center"
              >
                
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-12 h-12 text-white mb-4"
                  fill="currentColor"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"
                  />
                  <path
                    d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"
                  />
                </svg>

                <!-- ข้อความ -->
                <span class="text-white text-2xl font-semibold"
                  >Drop your beat here</span
                >
                <span class="text-gray-400 text-lg"
                  >or click to browse files</span
                >
              </label>
            </div>
          </div>

          <!-- Cover Art -->
          <div>
            <label class="block mb-2 font-semibold mt-6"
              >Cover Art (Optional)</label
            >
            <div
              class="relative border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-purple-500"
            >
              {{productForm.product_image}}
              <label
                for="{{productForm.product_image.id_for_label}}"
                class="cursor-pointer flex flex-col items-center"
                ><svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  class="w-12 h-12 text-white mb-4"
                  viewBox="0 0 16 16"
                >
                  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                  <path
                    d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"
                  />
                </svg>
                Upload cover art (JPG, PNG)
              </label>
            </div>
          </div>
        </div>

        <!-- Beat Info -->
        <div>
          <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
            <div>
              {{productForm.title.errors}}
              <label class="block mb-2 font-semibold">Beat Title</label>
              {{productForm.title}}
            </div>
            <div>
              {{productForm.description.errors}}
              <label class="block mb-2 font-semibold">Description</label>
              {{productForm.description}}
            </div>
          </div>

          <!-- Genre & BPM -->

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            <div>
              {{productForm.genre.errors}}
              <label class="block mb-2 font-semibold">Genre</label>
              {{productForm.genre}}
            </div>
            <div>
              {{productForm.bpm.errors}}
              <label class="block mb-2 font-semibold">BPM</label>
              {{productForm.bpm}}
            </div>
          </div>

          <!-- Theme Tags -->
          <div class="mt-6">
            {{productForm.theme.errors}}
            <label class="block mb-2 font-semibold">Theme</label>
            {{productForm.theme}}
            <p class="text-sm text-gray-400 mt-1">เลือกได้หลายอย่าง เช่น Sad, Chill, Party</p>
          </div>

          <div class="mt-6">
            {{productForm.music_key.errors}}
            <label class="block mb-2 font-semibold">Key</label>
            {{productForm.music_key}}
          </div>
        </div>
      </section>
      <!-- Pricing & Licensing -->
      <div class="space-y-4">
        <h2 class="text-lg font-semibold mb-2">Pricing & Licensing</h2>
        <p class="text-sm text-gray-400">
          กรุณาเลือกลิขสิทธิ์ที่ต้องการขายเพียงอย่างเดียว
        </p>

        <!-- hidden license_type field from the form -->
        {{ productForm.license_type }}
        <!-- widget = HiddenInput -->

        <!-- Custom radio cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-3">
          <button
            type="button"
            data-lic="royalty_free"
            class="lic-card p-4 rounded-lg bg-gray-700 text-left w-full"
          >
            <div class="font-semibold">Royalty-free License</div>
            <p class="text-sm text-gray-400 mt-1">
              อนุญาตให้ใช้ฟรี — ไม่ต้องมีราคา
            </p>
          </button>

          <button
            type="button"
            data-lic="non_exclusive"
            class="lic-card p-4 rounded-lg bg-gray-700 text-left w-full"
          >
            <div class="font-semibold">Non-exclusive License</div>
            <p class="text-sm text-gray-400 mt-1">
              เมื่อขายแล้ว ยังขายให้คนอื่นได้ — ต้องระบุราคา
            </p>
          </button>

          <button
            type="button"
            data-lic="exclusive"
            class="lic-card p-4 rounded-lg bg-gray-700 text-left w-full"
          >
            <div class="font-semibold">Exclusive License</div>
            <p class="text-sm text-gray-400 mt-1">
              ขายครั้งเดียว และจะถูกลบออกจากตลาด — ต้องระบุราคา
            </p>
          </button>
        </div>

        <!-- Price input (single field) -->
        <div id="price_wrap" class="mt-4 hidden">
          <label class="block mb-2 font-semibold" id="price_label"
            >Price (฿)</label
          >
          <div class="flex items-center gap-2">
            <span class="text-xl font-semibold">฿</span>
            {{ productForm.price }}
          </div>
          <div class="text-red-500 text-sm mt-1">
            {{ productForm.price.errors }}
          </div>
        </div>

        <!-- show any license errors -->
        <div class="text-red-500 text-sm mt-2">
          {{ productForm.license_type.errors }} 
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-right">
        <button
          type="submit"
          class="bg-purple-500 hover:bg-purple-600 px-6 py-3 rounded font-semibold"
        >
          Update
        </button>
      </div>
    </form>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const cards = document.querySelectorAll(".lic-card");
      const hiddenLicense = document.querySelector('[name="license_type"]')
      const priceWrap = document.getElementById("price_wrap");
      const priceInput = document.querySelector('[name="price"]');
      const priceLabel = document.getElementById("price_label");

      // เคลีย style
      function clearActive() {
        cards.forEach((c) => {
          c.classList.remove("ring-2", "ring-purple-500", "bg-gray-600");
          c.classList.add("bg-gray-700");
        });
      }

      function setLicense(value) {
        hiddenLicense.value = value;
        clearActive();
        const activeCard = Array.from(cards).find(
          (c) => c.dataset.lic === value
        );
        if (activeCard) {
          activeCard.classList.add("ring-2", "ring-purple-500", "bg-gray-600");
        }

        if (value === "royalty_free") {
          priceWrap.classList.add("hidden");
          if (priceInput) {
            priceInput.value = ""; // reset
            priceInput.removeAttribute("required");
          }
        } else {
          priceWrap.classList.remove("hidden");
          if (priceInput) priceInput.setAttribute("required", "required");

          // ปรับ label ตาม license
          priceLabel.textContent =
            value === "exclusive"
              ? "Price (Exclusive) ฿"
              : "Price (Non-exclusive) ฿";
        }
      }

      // initial: ถ้ามีค่าใน hidden license ให้ตั้ง UI
      if (hiddenLicense && hiddenLicense.value) {
        setLicense(hiddenLicense.value);
      }

      cards.forEach((card) => {
        card.addEventListener("click", () => {
          const lic = card.dataset.lic;
          setLicense(lic);
        });
      });

      // ป้องกันกรณี submit โดยไม่มี license
      const form = document.querySelector("form");
      if (form) {
        form.addEventListener("submit", (e) => {
          if (!hiddenLicense.value) {
            e.preventDefault();
            alert("กรุณาเลือกรูปแบบลิขสิทธิ์ก่อนส่ง");
          }
        });
      }
    });
  </script>
</body>
